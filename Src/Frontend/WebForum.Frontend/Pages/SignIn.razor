@page "/signin"
@using Fluxor
@using WebForum.Frontend.States.AuthState
@using WebForum.Frontend.States.AuthState.Actions

@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@inject IState<AuthState> AuthState
@inject IDispatcher Dispatcher
@inject NavigationManager Navigation

<div class="w-full h-screen flex flex-col justify-center items-center gap-2 pb-48">
    <h1 class="text-6xl font-bold text-primary my-8">Rubit</h1>
    <form class="flex flex-col justify-center items-center bg-primary-content rounded-box gap-3 p-3 w-96"
          @onsubmit="OnSubmit"
          @onsubmit:preventDefault="true"
          disabled="@AuthState.Value.IsLoading">
        <input class="input input-bordered w-full"
               type="text"
               placeholder="Login"
               @bind="signInForm.Login"/>
        <input class="input input-bordered w-full"
               type="password"
               placeholder="Password"
               @bind="signInForm.Password"/>
        <button class="btn btn-primary w-full"
                type="submit"
                disabled="@AuthState.Value.IsLoading">
            @if (!AuthState.Value.IsLoading)
            {
                <span>Sign in</span>
            }
            else
            {
                <span class="loading loading-spinner"></span>
                <span>loading</span>
            }
        </button>
    </form>
    <a class="link link-primary"
       @onclick="OnSignUpClick">
        sign up
    </a>
</div>

@code {
    private readonly SignInForm signInForm = new();

    private void OnSubmit(EventArgs args)
    {
        Dispatcher.Dispatch(new AuthLogInStartAction(signInForm.Login, signInForm.Password));

        StateHasChanged();
    }

    private void OnSignUpClick()
    {
        Navigation.NavigateTo("/signup");
    }

    private class SignInForm
    {
        public string Login { get; set; } = string.Empty;
        public string Password { get; set; } = string.Empty;
    }

}