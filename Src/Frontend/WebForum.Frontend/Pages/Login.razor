@page "/login"
@using Fluxor
@using WebForum.Frontend.States.AuthState
@using WebForum.Frontend.States.AuthState.Actions

@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@inject IState<AuthState> AuthState
@inject IDispatcher Dispatcher

<EditForm Model="@loginForm"
          OnValidSubmit="OnSubmit"
          class="mx-auto d-flex flex-column justify-center"
          style="height: 80%; width: 400px;">
    <MudCard>
        <MudCardContent>
            <MudTextField Label="Login"
                          Variant="Variant.Outlined"
                          @bind-Value="loginForm.Login"
                          Class="pb-4"/>
            <MudTextField Label="Password"
                          Variant="Variant.Outlined"
                          @bind-Value="loginForm.Password"
                          InputType="InputType.Password"
                          Class="pb-4"/>
            <MudText Color="Color.Error"
                     Style="min-height: 30px">
                @AuthState.Value.Error
            </MudText>
        </MudCardContent>
        <MudCardActions Class="d-flex flex-column align-stretch">
            <MudButton ButtonType="ButtonType.Submit"
                       Variant="Variant.Filled"
                       Size="Size.Large"
                       Color="Color.Primary"
                       Disabled="AuthState.Value.IsLoading">
                @if (AuthState.Value.IsLoading)
                {
                    <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true"/>
                    <MudText Class="ms-2">Processing</MudText>
                }
                else
                {
                    <MudText>Login</MudText>
                }
            </MudButton>
        </MudCardActions>
    </MudCard>
</EditForm>

@code {
    private readonly LoginForm loginForm = new LoginForm();

    private void OnSubmit()
    {
        Dispatcher.Dispatch(new AuthLogInStartAction(loginForm.Login, loginForm.Password));

        StateHasChanged();
    }
    
    private class LoginForm
    {
        public string Login { get; set; } = string.Empty;
        public string Password { get; set; } = string.Empty;
    }
}